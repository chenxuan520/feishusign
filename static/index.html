<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>WebSocket Demo</title>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
	<style>
		#qr {
			display: flex;
			justify-content: center;
			align-items: center;
			margin-top: 20px;
		}
	</style>
	<script>
		$(document).ready(function() {
			var token = {{.jwt}}
			// 从API获取meeting参数
			$.getJSON("http://" + window.location.host + "/api/admin/meeting/create?jwt="+ token, function(data) {
				var meeting = data.data.meeting;

				// 替换WebSocket请求的查询参数
				var wsUrl = "ws://" + window.location.host + "/api/admin/meeting/url?meeting=" + meeting + "&jwt=" + token;

				// 创建WebSocket连接
				var ws = new WebSocket(wsUrl);
				var qr = null;

				// 监听 WebSocket 接收到的消息
				ws.onmessage = function(event) {
					// 在页面上展示接收到的消息
					var messages = document.getElementById("messages");
					messages.innerHTML = "<p>" + event.data + "</p>";

					// 删除旧的二维码
					if (qr) {
						document.getElementById("qr").innerHTML = "";
						qr.clear();
					}

					// 生成新的二维码并展示出来
					qr = new QRCode(document.getElementById("qr"), {
						text: event.data,
						width: 400,
						height: 400,
						colorDark : "#000000",
						colorLight : "#ffffff",
						correctLevel : QRCode.CorrectLevel.H
					});
				};
			});
		});
	</script>
</head>
<body>
	<h1>WebSocket Demo</h1>
	<div id="messages"></div>
	<div id="qr"></div>
</body>
</html>

